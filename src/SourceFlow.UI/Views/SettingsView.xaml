<UserControl x:Class="SourceFlow.UI.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:SourceFlow.UI.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000">
    
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="10,5"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
        <Style TargetType="TextBlock" x:Key="SettingLabel">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="MinWidth" Value="150"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ヘッダー -->
        <StackPanel Grid.Row="0" Margin="10">
            <TextBlock Text="設定" FontSize="24" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBlock Text="アプリケーションの動作や外観をカスタマイズします" FontSize="14" Foreground="Gray"/>
        </StackPanel>

        <!-- ツールバー -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="10,0,10,10">
            <Button Content="保存" Command="{Binding SaveCommand}" 
                    IsEnabled="{Binding IsDirty}" FontWeight="Bold"/>
            <Button Content="リセット" Command="{Binding ResetCommand}"/>
            <ProgressBar Width="100" Height="20" Margin="10,0,0,0"
                        Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                        IsIndeterminate="True"/>
        </StackPanel>

        <!-- メインコンテンツ -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="0,0,20,0">
                
                <!-- 一般設定 -->
                <GroupBox Header="一般設定">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="自動保存:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding AutoSaveEnabled}" Content="有効にする"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="自動保存間隔 (分):" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding AutoSaveIntervalMinutes}" 
                                IsEnabled="{Binding AutoSaveEnabled}" Width="100" HorizontalAlignment="Left"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="同期時バックアップ:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding CreateBackupOnSync}" Content="バックアップを作成する"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="デフォルト作業ディレクトリ:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding DefaultWorkingDirectory}"/>
                        <Button Grid.Row="3" Grid.Column="2" Content="参照..." Command="{Binding BrowseWorkingDirectoryCommand}"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="削除操作の確認:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="4" Grid.Column="1" IsChecked="{Binding ConfirmDeleteOperations}" Content="削除前に確認ダイアログを表示"/>

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="隠しファイル表示:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding ShowHiddenFiles}" Content="隠しファイルを表示する"/>

                        <TextBlock Grid.Row="6" Grid.Column="0" Text="最大同時実行数:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding MaxConcurrentOperations}" Width="100" HorizontalAlignment="Left"/>
                    </Grid>
                </GroupBox>

                <!-- 外部ツール設定 -->
                <GroupBox Header="外部ツール">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="システム既定のテキストエディター:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding UseSystemDefaultTextEditor}" Content="使用する"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="カスタムテキストエディター:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding TextEditorPath}" 
                                IsEnabled="{Binding UseSystemDefaultTextEditor, Converter={x:Static converters:BooleanToVisibilityConverter.InverseBooleanConverter}}"/>
                        <Button Grid.Row="1" Grid.Column="2" Content="参照..." Command="{Binding BrowseTextEditorCommand}"
                               IsEnabled="{Binding UseSystemDefaultTextEditor, Converter={x:Static converters:BooleanToVisibilityConverter.InverseBooleanConverter}}"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="システム既定の差分ツール:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding UseSystemDefaultDiffTool}" Content="使用する"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="カスタム差分ツール:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding DiffToolPath}" 
                                IsEnabled="{Binding UseSystemDefaultDiffTool, Converter={x:Static converters:BooleanToVisibilityConverter.InverseBooleanConverter}}"/>
                        <Button Grid.Row="3" Grid.Column="2" Content="参照..." Command="{Binding BrowseDiffToolCommand}"
                               IsEnabled="{Binding UseSystemDefaultDiffTool, Converter={x:Static converters:BooleanToVisibilityConverter.InverseBooleanConverter}}"/>
                    </Grid>
                </GroupBox>

                <!-- ログ設定 -->
                <GroupBox Header="ログ設定">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="ログレベル:" Style="{StaticResource SettingLabel}"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" SelectedItem="{Binding LogLevel}" 
                                 ItemsSource="{Binding AvailableLogLevels}" Width="120" HorizontalAlignment="Left"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="ファイルログ:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding EnableFileLogging}" Content="ファイルにログを保存"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="ログファイルパス:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding LogFilePath}" 
                                IsEnabled="{Binding EnableFileLogging}"/>
                        <Button Grid.Row="2" Grid.Column="2" Content="参照..." Command="{Binding BrowseLogFileCommand}"
                               IsEnabled="{Binding EnableFileLogging}"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="最大ファイルサイズ (MB):" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding MaxLogFileSizeMB}" 
                                Width="100" HorizontalAlignment="Left" IsEnabled="{Binding EnableFileLogging}"/>

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="最大ファイル数:" Style="{StaticResource SettingLabel}"/>
                        <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding MaxLogFiles}" 
                                Width="100" HorizontalAlignment="Left" IsEnabled="{Binding EnableFileLogging}"/>
                    </Grid>
                </GroupBox>

                <!-- UI設定 -->
                <GroupBox Header="UI設定">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" Text="テーマ:" Style="{StaticResource SettingLabel}"/>
                        <ComboBox Grid.Row="0" Grid.Column="1" SelectedItem="{Binding Theme}" 
                                 ItemsSource="{Binding AvailableThemes}" Width="120" HorizontalAlignment="Left"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="ウィンドウ状態を復元:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="1" Grid.Column="1" IsChecked="{Binding RestoreWindowState}" Content="前回のウィンドウサイズと位置を復元"/>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="ステータスバー:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding ShowStatusBar}" Content="ステータスバーを表示"/>

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="アニメーション:" Style="{StaticResource SettingLabel}"/>
                        <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding EnableAnimations}" Content="UIアニメーションを有効にする"/>
                    </Grid>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>

        <!-- ステータスバー -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding IsDirty, StringFormat='変更: {0}'}" Foreground="Orange"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>